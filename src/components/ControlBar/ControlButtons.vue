<template>
  <div class="cb-buttons">
    <button
      class="cb-shuffle"
      :class="{ active: this.playback_state.shuffle }"
      @click="toggleShuffle"
    >
      <inline-svg :src="require('@/assets/icons/control-shuffle.svg')" />
    </button>

    <button class="cb-back" @click="previousTrack">
      <inline-svg :src="require('@/assets/icons/control-back.svg')" />
    </button>

    <button class="cb-playpause" @click="playPause">
      <inline-svg
        v-if="this.playback_state.paused"
        :src="require('@/assets/icons/control-play.svg')"
        width="30px"
        height="30px"
      />
      <inline-svg
        v-else
        :src="require('@/assets/icons/control-pause.svg')"
        width="30px"
        height="30px"
      />
    </button>

    <button class="cb-forward" @click="nextTrack">
      <inline-svg :src="require('@/assets/icons/control-forward.svg')" />
    </button>

    <button
      class="cb-repeat"
      :class="[
        { active: this.playback_state.repeat_mode !== 0 },
        { track: this.playback_state.repeat_mode === 2 },
      ]"
      @click="toggleRepeatMode"
    >
      <inline-svg :src="require('@/assets/icons/control-repeat.svg')" />
    </button>
  </div>
</template>

<script lang="ts">
import { Vue, Options } from "vue-class-component";
import api from "@/api";

@Options({
  props: {
    player: Object,
    device_id: String,
    playback_state: Object,
  },

  methods: {
    async playPause() {
      //
      await api.spotify.SDK.togglePlay(this.player);
    },

    async previousTrack() {
      //
      await api.spotify.SDK.previousTrack(this.player);
    },

    async nextTrack() {
      //
      await api.spotify.SDK.nextTrack(this.player);
    },

    toggleShuffle() {
      api.spotify.player.togglePlaybackShuffle({
        query: {
          state: !this.playback_state.shuffle,
          device_id: this.device_id,
        },
      });
    },

    toggleRepeatMode() {
      let repeat_mode = "";
      switch (this.playback_state.repeat_mode) {
        case 0:
          repeat_mode = "context";
          break;
        case 1:
          repeat_mode = "track";
          break;
        case 2:
          repeat_mode = "off";
          break;
      }

      api.spotify.player.setRepeatMode({
        query: {
          state: repeat_mode,
          device_id: this.device_id,
        },
      });
    },
  },
})
export default class ControlButtons extends Vue {}
</script>

<style scoped lang="scss">
.cb-buttons {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  flex-grow: 1;
  height: 40px;

  button {
    position: relative;
    background: none;
    border: 0;
    height: 100%;
    width: 50px;
    margin: 0 2px;

    svg {
      fill: var(--color-control);
      transition: all 0.3s ease;
    }

    &.active svg {
      fill: var(--color-accent-light);
    }

    &.track:after {
      content: "1";
      position: absolute;
      top: 0px;
      right: 4px;
      color: var(--color-fg);
      font-size: 10pt;
      font-weight: bold;
      width: 20px;
      height: 20px;
      background-color: var(--color-accent);
      border-radius: 50%;
    }

    &:hover {
      cursor: pointer;

      svg {
        fill: var(--color-control-light);
      }

      &.active svg {
        fill: #a3a1eb;
      }
    }
  }
}
</style>
