(function(e){function t(t){for(var r,o,s=t[0],i=t[1],u=t[2],p=0,d=[];p<s.length;p++)o=s[p],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r]);l&&l(t);while(d.length)d.shift()();return c.push.apply(c,u||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,s=1;s<n.length;s++){var i=n[s];0!==a[i]&&(r=!1)}r&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},c=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/sound-flow/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],i=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=i;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},1259:function(e,t,n){"use strict";n("373b")},1929:function(e,t,n){},2152:function(e,t,n){"use strict";n("90ad")},"25a8":function(e,t,n){"use strict";n("5a54")},"373b":function(e,t,n){},"395a":function(e,t,n){e.exports=n.p+"img/control-repeat.1b31dc56.svg"},"3a78":function(e,t,n){},"411c":function(e,t,n){"use strict";n("1929")},4264:function(e,t,n){},"4e0c":function(e,t,n){"use strict";n("efd5")},"5a54":function(e,t,n){},"6bad":function(e,t,n){"use strict";n("ddc6")},"8ba3":function(e,t,n){e.exports=n.p+"img/control-back.5fcd24e1.svg"},"90ad":function(e,t,n){},b4e8:function(e,t,n){"use strict";n("3a78")},cab9:function(e,t,n){e.exports=n.p+"img/control-shuffle.aa0319cb.svg"},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function a(e,t){var n=Object(r["resolveComponent"])("router-view");return Object(r["openBlock"])(),Object(r["createBlock"])(n)}n("2152");var c=n("6b0d"),o=n.n(c);const s={},i=o()(s,[["render",a]]);var u=i,l=n("6c02"),p={key:1,class:"home"};function d(e,t,n,a,c,o){var s=Object(r["resolveComponent"])("CircleLoader"),i=Object(r["resolveComponent"])("ControlBar");return this.loading?(Object(r["openBlock"])(),Object(r["createBlock"])(s,{key:0})):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",p,[Object(r["createVNode"])(i)]))}var b=n("1da1"),f=n("bee2"),h=n("d4ec"),v=n("262e"),m=n("2caf"),y=(n("d3b7"),n("96cf"),n("9ab4")),g=n("ce1f");function k(e,t,n,a,c,o){return Object(r["openBlock"])(),Object(r["createElementBlock"])("span")}var j=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n)}(g["b"]);n("25a8");const O=o()(j,[["render",k],["__scopeId","data-v-dcff6744"]]);var w=O,_=function(e){return Object(r["pushScopeId"])("data-v-206fd301"),e=e(),Object(r["popScopeId"])(),e},S={class:"control-bar"},x=_((function(){return Object(r["createElementVNode"])("div",{class:"cb-left"},null,-1)})),P={class:"cb-center"},T=_((function(){return Object(r["createElementVNode"])("div",{class:"cb-right"},null,-1)}));function C(e,t,n,a,c,o){var s=Object(r["resolveComponent"])("ControlButtons"),i=Object(r["resolveComponent"])("ControlPlayback");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",S,[x,Object(r["createElementVNode"])("div",P,[Object(r["createVNode"])(s),Object(r["createVNode"])(i)]),T])}var E={class:"cb-buttons"};function B(e,t,a,c,o,s){var i=Object(r["resolveComponent"])("inline-svg");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",E,[Object(r["createElementVNode"])("button",{class:Object(r["normalizeClass"])(["cb-shuffle",{active:this.$store.state.player.playback_state.shuffle}]),onClick:t[0]||(t[0]=function(){return e.toggleShuffle&&e.toggleShuffle.apply(e,arguments)})},[Object(r["createVNode"])(i,{src:n("cab9"),width:"30",height:"30"},null,8,["src"])],2),Object(r["createElementVNode"])("button",{class:"cb-back",onClick:t[1]||(t[1]=function(){return e.previousTrack&&e.previousTrack.apply(e,arguments)})},[Object(r["createVNode"])(i,{src:n("8ba3"),width:"20",height:"20"},null,8,["src"])]),Object(r["createElementVNode"])("button",{class:"cb-playpause",onClick:t[2]||(t[2]=function(){return e.playPause&&e.playPause.apply(e,arguments)})},[this.$store.state.player.playback_state.paused?(Object(r["openBlock"])(),Object(r["createBlock"])(i,{key:0,src:n("d08e"),width:"35",height:"35"},null,8,["src"])):(Object(r["openBlock"])(),Object(r["createBlock"])(i,{key:1,src:n("dd7f"),width:"35",height:"35"},null,8,["src"]))]),Object(r["createElementVNode"])("button",{class:"cb-forward",onClick:t[3]||(t[3]=function(){return e.nextTrack&&e.nextTrack.apply(e,arguments)})},[Object(r["createVNode"])(i,{src:n("ce1e"),width:"20",height:"20"},null,8,["src"])]),Object(r["createElementVNode"])("button",{class:Object(r["normalizeClass"])(["cb-repeat",[{active:0!==this.$store.state.player.playback_state.repeat_mode},{track:2===this.$store.state.player.playback_state.repeat_mode}]]),onClick:t[4]||(t[4]=function(){return e.toggleRepeatMode&&e.toggleRepeatMode.apply(e,arguments)})},[Object(r["createVNode"])(i,{src:n("395a"),width:"20",height:"20"},null,8,["src"])],2)])}var V="https://api-sf.mznx.xyz",$=function(e,t){var n=V+t;return fetch(n,{method:e}).then((function(e){return e.json()}))},I=$,N={getUserAuthURL:function(){var e="/auth/login",t="GET";return I(t,e)},checkToken:function(e){var t="/auth/check_token?access_token=".concat(e),n="GET";return I(n,t)}},R={auth:N},D={init:function(e){return new Promise((function(t){window.onSpotifyWebPlaybackSDKReady=function(){var n=new window.Spotify.Player({name:"Sound Flow (Web Playback SDK)",getOAuthToken:function(t){t(e)},volume:.5});t(n)}}))},connect:function(e){return new Promise((function(t){e.addListener("ready",(function(e){t(e)})),e.connect().then((function(e){}))}))},disconnect:function(e){e.disconnect()},togglePlay:function(e){e.togglePlay()},previousTrack:function(e){e.previousTrack()},nextTrack:function(e){e.nextTrack()}},L=(n("99af"),"https://api.spotify.com/v1"),M=function(e){var t=L+e.path;return fetch(t,{method:e.method,headers:{Authorization:"Bearer "+localStorage.getItem("access_token")},body:e.body?e.body:null}).then((function(e){e.json().then((function(){return e.json()}),(function(){return null}))}))},K=M,A={getAlbum:function(e){var t={method:"GET",path:"/albums/".concat(e)};return K(t)},getAlbums:function(e,t){var n={method:"GET",path:"/albums?ids=".concat(e,"&market=").concat(t)};return K(n)},getAlbumsTracks:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={method:"GET",path:"/albums/".concat(e,"/tracks?market=").concat(t,"&limit=").concat(n,"&offset=").concat(r)};return K(a)}},U=(n("e9c4"),{getPlaybackState:function(){var e={method:"GET",path:"/me/player"};return K(e)},getAvailableDevices:function(){var e={method:"GET",path:"/me/player/devices"};return K(e)},transferPlayback:function(e){var t={method:"PUT",path:"/me/player",body:JSON.stringify({device_ids:[e]})};return K(t)},togglePlaybackShuffle:function(e,t){var n={method:"PUT",path:"/me/player/shuffle?state=".concat(e,"&device_id=").concat(t)};return K(n)},toggleRepeatMode:function(e,t){var n={method:"PUT",path:"/me/player/repeat?state=".concat(e,"&device_id=").concat(t)};return K(n)}}),G={SDK:D,albums:A,player:U},z={backend:R,spotify:G},q=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n)}(g["b"]);q=Object(y["a"])([Object(g["a"])({data:function(){return{}},methods:{playPause:function(){z.spotify.SDK.togglePlay(this.$store.state.player.player)},previousTrack:function(){z.spotify.SDK.previousTrack(this.$store.state.player.player)},nextTrack:function(){z.spotify.SDK.nextTrack(this.$store.state.player.player)},toggleShuffle:function(){z.spotify.player.togglePlaybackShuffle(!this.$store.state.player.playback_state.shuffle,this.$store.state.player.device_id)},toggleRepeatMode:function(){var e="";switch(this.$store.state.player.playback_state.repeat_mode){case 0:e="context";break;case 1:e="track";break;case 2:e="off";break}z.spotify.player.toggleRepeatMode(e,this.$store.state.player.device_id)}}})],q);var H=q;n("4e0c");const J=o()(H,[["render",B],["__scopeId","data-v-421c0b24"]]);var F=J,W={class:"cb-playback"},X={class:"cb-progress-time"},Q={class:"cb-progress-bar"},Y={class:"cb-progress-time"};function Z(e,t,n,a,c,o){var s=Object(r["resolveComponent"])("vue-slider");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",W,[Object(r["createElementVNode"])("div",X,Object(r["toDisplayString"])(e.msToTime(e.progress)),1),Object(r["createElementVNode"])("div",Q,[Object(r["createVNode"])(s,{modelValue:e.progress,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.progress=t}),max:e.duration,onChange:e.onProgressChange,tooltip:"none",railStyle:{background:"var(--color-control)"},processStyle:{background:"var(--color-accent)"}},null,8,["modelValue","max","onChange","railStyle","processStyle"])]),Object(r["createElementVNode"])("div",Y,Object(r["toDisplayString"])(e.msToTime(e.duration)),1)])}n("b65f");var ee=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n)}(g["b"]);ee=Object(y["a"])([Object(g["a"])({data:function(){return{progress:0,duration:0,inverval:null}},computed:{is_playing:function(){return this.$store.state.player.playback_state.paused},context:function(){return this.$store.state.player.playback_state.context}},methods:{updateProgress:function(){var e=this;clearInterval(this.inverval),this.progress=this.$store.state.player.playback_state.position,this.$store.state.player.playback_state.paused||(this.inverval=setInterval((function(){e.progress+1e3<=e.duration&&(e.progress+=1e3)}),1e3))},onProgressChange:function(e){console.log(e),this.$store.state.player.player.seek(e)},msToTime:function(e){var t=Math.trunc(e/6e4),n=Math.trunc((e-6e4*t)/1e3),r=String(n);return n<10&&(r="0"+r),t+":"+r}},watch:{context:function(){this.duration=this.$store.state.player.playback_state.duration,this.progress=this.$store.state.player.playback_state.position},is_playing:function(){this.updateProgress()}},mounted:function(){this.duration=this.$store.state.player.playback_state.duration,this.updateProgress()}})],ee);var te=ee;n("dee2");const ne=o()(te,[["render",Z],["__scopeId","data-v-83ee0c28"]]);var re=ne,ae=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n)}(g["b"]);ae=Object(y["a"])([Object(g["a"])({components:{ControlButtons:F,ControlPlayback:re}})],ae);var ce=ae;n("b4e8");const oe=o()(ce,[["render",C],["__scopeId","data-v-206fd301"]]);var se=oe,ie=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n)}(g["b"]);ie=Object(y["a"])([Object(g["a"])({data:function(){return{loading:!0,token:null}},components:{CircleLoader:w,ControlBar:se},methods:{run:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.connectToSpotifySDK();case 2:e.loading=!1;case 3:case"end":return t.stop()}}),t)})))()},connectToSpotifySDK:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var n,r,a,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=function(){var t=Object(b["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=setInterval(Object(b["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=e.$store.state.player.playback_state,null!==a&&(clearInterval(n),t(a));case 2:case"end":return r.stop()}}),r)}))))})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),r=document.createElement("script"),r.src="https://sdk.scdn.co/spotify-player.js",r.async=!0,document.body.appendChild(r),t.next=7,z.spotify.SDK.init(e.token);case 7:return a=t.sent,a.addListener("player_state_changed",(function(t){e.$store.commit("setPlaybackState",t)})),t.next=11,z.spotify.SDK.connect(a);case 11:return c=t.sent,e.$store.commit("setPlayer",a),e.$store.commit("setDeviceID",c.device_id),t.next=16,z.spotify.player.transferPlayback(e.$store.state.player.device_id);case 16:return t.next=18,n();case 18:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.token=localStorage.getItem("access_token"),t.next=3,z.backend.auth.checkToken(e.token);case 3:n=t.sent,n&&"ok"===n.status?e.run():e.$router.push({name:"Login"});case 5:case"end":return t.stop()}}),t)})))()}})],ie);var ue=ie;n("1259");const le=o()(ue,[["render",d],["__scopeId","data-v-c4d7dec0"]]);var pe=le,de=function(e){return Object(r["pushScopeId"])("data-v-a1000ac4"),e=e(),Object(r["popScopeId"])(),e},be={class:"login"},fe=de((function(){return Object(r["createElementVNode"])("h1",null,"Пожалуйста, авторизуйтесь через Spotify.",-1)}));function he(e,t,n,a,c,o){var s=Object(r["resolveComponent"])("CircleLoader");return Object(r["openBlock"])(),Object(r["createElementBlock"])(r["Fragment"],null,[this.process?(Object(r["openBlock"])(),Object(r["createBlock"])(s,{key:0})):Object(r["createCommentVNode"])("",!0),Object(r["createElementVNode"])("div",be,[fe,Object(r["createElementVNode"])("button",{onClick:t[0]||(t[0]=function(){return e.login&&e.login.apply(e,arguments)}),class:"btn"},"Войти")])],64)}n("9911");var ve=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n)}(g["b"]);ve=Object(y["a"])([Object(g["a"])({data:function(){return{process:!1}},components:{CircleLoader:w},methods:{login:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var n,r,a,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=document.querySelector(".login h1"),r=document.querySelector(".login button"),n&&r&&(n.style.transform="translateX(-100vw)",r.style.transform="translateX(100vw)"),e.process=!0,t.next=6,z.backend.auth.getUserAuthURL();case 6:a=t.sent,a.state&&(localStorage.setItem(a.state_key,a.state),c=window.open(a.link,"Login with Spotify","width=800,height=600"),c&&window.addEventListener("message",(function(t){var n=t.data;switch(n.status){case"ok":e.$router.push({name:"Home"});break;default:console.log("switch (data.status): default")}}),!1));case 8:case"end":return t.stop()}}),t)})))()},checkToken:function(){return Object(b["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("access_token"),!t){e.next=7;break}return e.next=4,z.backend.auth.checkToken(t);case 4:if(n=e.sent,!n||"ok"!==n.status){e.next=7;break}return e.abrupt("return",!0);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e)})))()}},mounted:function(){var e=this;return Object(b["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkToken();case 2:n=t.sent,n&&e.$router.push({name:"Home"});case 4:case"end":return t.stop()}}),t)})))()}})],ve);var me=ve;n("411c");const ye=o()(me,[["render",he],["__scopeId","data-v-a1000ac4"]]);var ge=ye,ke={class:"callback"};function je(e,t,n,a,c,o){var s=Object(r["resolveComponent"])("CircleLoader");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",ke,[Object(r["createVNode"])(s)])}var Oe=function(e){Object(v["a"])(n,e);var t=Object(m["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n)}(g["b"]);Oe=Object(y["a"])([Object(g["a"])({components:{CircleLoader:w},mounted:function(){var e=this.$route.query;e&&e.access_token?(localStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token),window.opener.postMessage({status:"ok"})):e.error?window.opener.postMessage({status:e.error}):window.opener.postMessage({status:"invalid query"}),localStorage.removeItem("spotify_auth_state"),window.close()}})],Oe);var we=Oe;n("6bad");const _e=o()(we,[["render",je],["__scopeId","data-v-33337956"]]);var Se=_e,xe=[{path:"/",name:"Home",component:pe},{path:"/login",name:"Login",component:ge},{path:"/callback",name:"Callback",component:Se}],Pe=Object(l["a"])({history:Object(l["b"])(),routes:xe}),Te=Pe,Ce=n("6d5e"),Ee=n.n(Ce),Be=n("4971"),Ve=n.n(Be),$e=(n("24df"),n("5502")),Ie={player:null,device_id:null,playback_state:null};function Ne(e){return e.player}function Re(e){return e.device_id}function De(e){return e.playback_state}var Le={getPlayer:Ne,getDeviceID:Re,getPlaybackState:De};function Me(e,t){e.player=t}function Ke(e,t){e.device_id=t}function Ae(e,t){e.playback_state=t}var Ue={setPlayer:Me,setDeviceID:Ke,setPlaybackState:Ae},Ge={},ze={state:Ie,getters:Le,mutations:Ue,actions:Ge},qe=Object($e["a"])({state:{},mutations:{},actions:{},modules:{player:ze}});Object(r["createApp"])(u).use(Te).use(qe).component("inline-svg",Ee.a).component("VueSlider",Ve.a).mount("#app")},ce1e:function(e,t,n){e.exports=n.p+"img/control-forward.0892bb3f.svg"},d08e:function(e,t,n){e.exports=n.p+"img/control-play.2f25944e.svg"},dd7f:function(e,t,n){e.exports=n.p+"img/control-pause.e75d8a30.svg"},ddc6:function(e,t,n){},dee2:function(e,t,n){"use strict";n("4264")},efd5:function(e,t,n){}});
//# sourceMappingURL=app.76ff90f9.js.map